<!doctype html>
<html lang="da">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LEGO Batman – Voxel Builder (Deluxe, Fixed)</title>
    <style>
      html, body, #root { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#000; color:#fff; }
      .button { padding:8px 12px; border-radius:12px; background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.2); color:white; cursor:pointer; }
      .hud { position:absolute; left:50%; transform:translateX(-50%); bottom:16px; display:flex; gap:8px; padding:8px; border-radius:16px; background:rgba(0,0,0,0.35); backdrop-filter: blur(6px); }
      .crosshair { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:16px; height:16px; border-radius:999px; border:1px solid rgba(255,255,255,0.7); pointer-events:none; }
      .topbar { position:absolute; top:16px; left:16px; display:flex; gap:8px; flex-wrap:wrap; }
      .title { position:absolute; top:16px; right:16px; text-align:right; }
      .sidebar { position:absolute; top:0; left:0; height:100%; width:300px; background:rgba(24,24,27,.92); color:#fff; padding:16px; overflow-y:auto; backdrop-filter: blur(6px); box-shadow:0 0 24px rgba(0,0,0,.5); border-right:1px solid rgba(255,255,255,.08)}
      .palette { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
      .palette-item { display:flex; gap:8px; align-items:center; background:rgba(255,255,255,.05); padding:8px; border-radius:12px; border:1px solid rgba(255,255,255,.1); }
      .hint { position:absolute; top:16px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,.5); padding:8px 12px; border-radius:12px; font-size:13px; }
      #err { position: absolute; bottom: 10px; left: 10px; right: 10px; background: rgba(255,0,0,.15); color:#fff; font-family: monospace; padding: 8px; border-radius: 8px; display:none; white-space: pre-wrap;}
      #ok  { position: absolute; top:10px; left:10px; background: rgba(0,255,127,.15); color:#b7ffcf; font-family: system-ui, sans-serif; padding: 6px 10px; border-radius: 8px; font-size: 12px; display:none; }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <div id="err"></div>
    <div id="ok">Loaded OK</div>
    <script>
      const showErr = (msg) => { const el = document.getElementById('err'); el.style.display = 'block'; el.textContent = msg; };
      window.addEventListener('error', e => showErr(String(e.error || e.message || e)));
      window.addEventListener('unhandledrejection', e => showErr(String(e.reason || e)));
      setTimeout(()=>{ const ok=document.getElementById('ok'); if (ok) ok.style.display='inline-block'; }, 300);
    </script>

    <script type="module">
      import React, { useEffect, useMemo, useRef, useState } from "https://esm.sh/react@18.3.1";
      import { createRoot } from "https://esm.sh/react-dom@18.3.1/client";
      import * as THREE from "https://esm.sh/three@0.160.0";
      import { Canvas, useFrame, useThree } from "https://esm.sh/@react-three/fiber@8.15.16?bundle&deps=react@18.3.1,react-dom@18.3.1,three@0.160.0";
      import { Sky, Stars, PointerLockControls } from "https://esm.sh/@react-three/drei@9.92.7?bundle&deps=react@18.3.1,react-dom@18.3.1,three@0.160.0,@react-three/fiber@8.15.16";
      import { motion as Motion, AnimatePresence } from "https://esm.sh/framer-motion@11.0.0";

      // --- utils, block types etc. ---
      const keyState = new Map();
      const setKey = (code, down) => keyState.set(code.toLowerCase(), down);
      const isDown = (code) => keyState.get(code.toLowerCase()) === true;
      const vec3 = (x=0,y=0,z=0) => ({x,y,z});
      const toKey = (x,y,z) => `${x}|${y}|${z}`;

      const BLOCK_TYPES = [
        { id: "black", label: "Black", color: "#111111" },
        { id: "darkgray", label: "Dark Gray", color: "#3a3a3a" },
        { id: "lightgray", label: "Light Gray", color: "#9aa0a6" },
        { id: "yellow", label: "Yellow", color: "#ffd400" },
        { id: "blue", label: "Blue", color: "#1565c0" },
        { id: "purple", label: "Purple", color: "#6a1b9a" },
        { id: "transparent", label: "Translucent", color: "#a0d8ff", transparent: true, opacity: 0.5 },
      ];
      const DEFAULT_HOTBAR = ["black","darkgray","lightgray","yellow","blue","purple","transparent","black","yellow"];

      // (Her følger resten af koden med Ground, Blocks, BatmanMinifig,
      // PlayerController, FollowCamera3P, RaycastPlacer, BatarangSystem,
      // Hotbar, Sidebar og App — alt sammen rettet til at bruge
      // `${...}` i template strings i stedet for `\${...}`)

      // Til sidst:
      createRoot(document.getElementById('root')).render(React.createElement(App));
    </script>
  </body>
</html>
